<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Apache Curator 简介 - Coding Man</title><meta name="Description" content="在本文中，我们了解了如何使用 Apache Curator 连接到 Apache Zookeeper 并利用其主要功能。"><meta property="og:title" content="Apache Curator 简介" />
<meta property="og:description" content="在本文中，我们了解了如何使用 Apache Curator 连接到 Apache Zookeeper 并利用其主要功能。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://itcodingman.github.io/apache_curator/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-05-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-07-25T00:00:00+00:00" /><meta property="og:site_name" content="My cool site" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Apache Curator 简介"/>
<meta name="twitter:description" content="在本文中，我们了解了如何使用 Apache Curator 连接到 Apache Zookeeper 并利用其主要功能。"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2168947316195146"
     crossorigin="anonymous"></script><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://itcodingman.github.io/apache_curator/" /><link rel="prev" href="http://itcodingman.github.io/apache_crunch/" /><link rel="next" href="http://itcodingman.github.io/apache_cxf_rest_api/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Apache Curator 简介",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/itcodingman.github.io\/apache_curator\/"
        },"genre": "posts","wordcount":  2137 ,
        "url": "http:\/\/itcodingman.github.io\/apache_curator\/","datePublished": "2018-05-07T00:00:00+00:00","dateModified": "2022-07-25T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "codingman"
            },"description": "在本文中，我们了解了如何使用 Apache Curator 连接到 Apache Zookeeper 并利用其主要功能。"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Coding Man"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/logo.jpg"
        data-srcset="/logo.jpg, /logo.jpg 1.5x, /logo.jpg 2x"
        data-sizes="auto"
        alt="/logo.jpg"
        title="/logo.jpg" />Coding Man</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 
										</a><a class="menu-item" href="/tags/"> 标签 
										</a><a class="menu-item" href="/categories/"> 分类 
										</a><a class="menu-item" href="/search/"><i class='fas fa-fw fa-search'></i> 搜索 
										</a>
										<div class="dropdown">
											<a href="javascript:void(0);" class="menu-item menu-more dropbtn" title="" > 链接 
											</a>
											<div class="menu-more-content dropdown-content"><a href="https://space.bilibili.com/499533333" title="" target="_blank" rel="noopener"> BiliBili </a><a href="https://www.youtube.com/c/itcodingman" title="" target="_blank" rel="noopener"> YouTube </a></div>
										</div>
									<span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Coding Man"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/logo.jpg"
        data-srcset="/logo.jpg, /logo.jpg 1.5x, /logo.jpg 2x"
        data-sizes="auto"
        alt="/logo.jpg"
        title="/logo.jpg" />Coding Man</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/"> 文章 
								</a><a class="menu-item" href="/tags/"> 标签 
								</a><a class="menu-item" href="/categories/"> 分类 
								</a><a class="menu-item" href="/search/"><i class='fas fa-fw fa-search'></i> 搜索 
								</a>
								<div class="dropdown">
									<a href="javascript:void(0);" class="menu-item menu-more dropbtn" title="" > 链接 
									</a>
									<div class="menu-more-content dropdown-content"><a href="https://space.bilibili.com/499533333" title="" target="_blank" rel="noopener"> BiliBili </a><a href="https://www.youtube.com/c/itcodingman" title="" target="_blank" rel="noopener"> YouTube </a></div>
								</div>
							<a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container">
                    <div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Apache Curator 简介</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>codingman</a></span>&nbsp;<span class="post-category">included in <a href="/categories/cloud/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Cloud</a>&nbsp;<a href="/categories/devops/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>DevOps</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2018-05-07">2018-05-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2137 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-简介"><strong>1. 简介</strong></a></li>
    <li><a href="#2-先决条件"><strong>2. 先决条件</strong></a></li>
    <li><a href="#3-连接管理"><strong>3. 连接管理</strong></a></li>
    <li><a href="#4异步"><strong>4.异步</strong></a></li>
    <li><a href="#5-配置管理"><strong>5. 配置管理</strong></a>
      <ul>
        <li><a href="#51-观察者"><strong>5.1 观察者</strong></a></li>
      </ul>
    </li>
    <li><a href="#6-强类型模型"><strong>6. 强类型模型</strong></a></li>
    <li><a href="#7-recipes"><strong>7. recipes</strong></a>
      <ul>
        <li><a href="#71-领袖选举"><strong>7.1 领袖选举</strong></a></li>
        <li><a href="#72-共享锁"><strong>7.2. 共享锁</strong></a></li>
        <li><a href="#73-计数器"><strong>7.3. 计数器</strong></a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="1-简介"><strong>1. 简介</strong></h2>
<p><a href="https://curator.apache.org/" target="_blank" rel="noopener noreffer">Apache Curator</a>是 Apache Zookeeper 的 Java 客户端，<a href="https://zookeeper.apache.org/" target="_blank" rel="noopener noreffer">Apache Zookeeper</a>是分布式应用程序的流行协调服务。</p>
<p>在本教程中，我们将介绍 Curator 提供的一些最相关的功能：</p>
<ul>
<li>连接管理——管理连接和重试策略</li>
<li>异步——通过添加异步功能和使用 Java 8 lambda 来增强现有客户端</li>
<li>配置管理——对系统进行集中配置</li>
<li>强类型模型——使用类型模型</li>
<li>食谱——实现领导者选举、分布式锁或计数器</li>
</ul>
<h2 id="2-先决条件"><strong>2. 先决条件</strong></h2>
<p>首先，建议快速了解一下<a href="https://zookeeper.apache.org/" target="_blank" rel="noopener noreffer">Apache Zookeeper</a>及其功能。</p>
<p>对于本教程，我们假设已经有一个独立的 Zookeeper 实例在<em>127.0.0.1:2181</em>上运行；如果您刚刚开始，<a href="https://zookeeper.apache.org/doc/current/zookeeperStarted.html" target="_blank" rel="noopener noreffer">这里有关于如何安装和运行它的说明。</a></p>
<p>首先，我们需要将<a href="https://search.maven.org/classic/#search%7Cgav%7C1%7Cg%3A%22org.apache.curator%22%20AND%20a%3A%22curator-x-async%22" target="_blank" rel="noopener noreffer">curator-x-async</a>依赖项添加到我们的<em>pom.xml</em>中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.apache.curator<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>curator-x-async<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>4.0.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;exclusions&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;exclusion&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.apache.zookeeper<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>zookeeper<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/exclusion&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/exclusions&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p><strong>最新版本的 Apache Curator 4.XX 与 Zookeeper 3.5.X 存在硬依赖关系</strong>，目前仍处于测试阶段。</p>
<p>因此，在本文中，我们将使用当前最新的稳定<a href="https://zookeeper.apache.org/doc/r3.4.11/index.html" target="_blank" rel="noopener noreffer">版 Zookeeper 3.4.11</a>。</p>
<p>所以我们需要排除 Zookeeper 依赖，并将<a href="https://search.maven.org/classic/#search%7Cgav%7C1%7Cg%3A%22org.apache.zookeeper%22%20AND%20a%3A%22zookeeper%22" target="_blank" rel="noopener noreffer">Zookeeper 版本的依赖</a>添加到我们的<em>pom.xml</em>中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.apache.zookeeper<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>zookeeper<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>3.4.11<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>有关兼容性的更多信息，请参阅<a href="https://curator.apache.org/zk-compatibility-34.html" target="_blank" rel="noopener noreffer">此链接</a>。</p>
<h2 id="3-连接管理"><strong>3. 连接管理</strong></h2>
<p><strong>Apache Curator 的基本用例是连接到正在运行的 Apache Zookeeper 实例</strong>。</p>
<p>该工具提供了一个工厂来使用重试策略建立与 Zookeeper 的连接：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">sleepMsBetweenRetries</span> <span class="o">=</span> <span class="n">100</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">maxRetries</span> <span class="o">=</span> <span class="n">3</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="n">RetryPolicy</span> <span class="n">retryPolicy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RetryNTimes</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">maxRetries</span><span class="o">,</span> <span class="n">sleepMsBetweenRetries</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">CuratorFramework</span> <span class="n">client</span> <span class="o">=</span> <span class="n">CuratorFrameworkFactory</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">newClient</span><span class="o">(</span><span class="s">&#34;127.0.0.1:2181&#34;</span><span class="o">,</span> <span class="n">retryPolicy</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">assertThat</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">checkExists</span><span class="o">().</span><span class="na">forPath</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">)).</span><span class="na">isNotNull</span><span class="o">();</span>
</span></span></code></pre></div><p>在这个快速示例中，我们将重试 3 次，并在重试之间等待 100 毫秒，以防出现连接问题。</p>
<p><em>使用CuratorFramework</em>客户端连接到 Zookeeper后，我们现在可以浏览路径、获取/设置数据并与服务器进行交互。</p>
<h2 id="4异步"><strong>4.异步</strong></h2>
<p><strong>Curator Async 模块包装了上述<em>CuratorFramework</em></strong>客户端，以使用<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletionStage.html" target="_blank" rel="noopener noreffer">CompletionStage Java 8 API</a><strong>提供非阻塞功能</strong>。</p>
<p>让我们看看前面的示例如何使用 Async 包装器：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">sleepMsBetweenRetries</span> <span class="o">=</span> <span class="n">100</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">maxRetries</span> <span class="o">=</span> <span class="n">3</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="n">RetryPolicy</span> <span class="n">retryPolicy</span> 
</span></span><span class="line"><span class="cl">  <span class="o">=</span> <span class="k">new</span> <span class="n">RetryNTimes</span><span class="o">(</span><span class="n">maxRetries</span><span class="o">,</span> <span class="n">sleepMsBetweenRetries</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">CuratorFramework</span> <span class="n">client</span> <span class="o">=</span> <span class="n">CuratorFrameworkFactory</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">newClient</span><span class="o">(</span><span class="s">&#34;127.0.0.1:2181&#34;</span><span class="o">,</span> <span class="n">retryPolicy</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">AsyncCuratorFramework</span> <span class="n">async</span> <span class="o">=</span> <span class="n">AsyncCuratorFramework</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">AtomicBoolean</span> <span class="n">exists</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicBoolean</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span><span class="o">.</span><span class="na">checkExists</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">forPath</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">thenAcceptAsync</span><span class="o">(</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="n">exists</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">s</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">await</span><span class="o">().</span><span class="na">until</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">assertThat</span><span class="o">(</span><span class="n">exists</span><span class="o">.</span><span class="na">get</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">());</span>
</span></span></code></pre></div><p>现在，*checkExists()<em>操作在异步模式下工作，不会阻塞主线程。我们还可以使用</em>thenAcceptAsync()*方法一个接一个地链接操作，该方法使用<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletionStage.html" target="_blank" rel="noopener noreffer">CompletionStage API</a>。</p>
<h2 id="5-配置管理"><strong>5. 配置管理</strong></h2>
<p>在分布式环境中，最常见的挑战之一是管理许多应用程序之间的共享配置。<strong>我们可以使用 Zookeeper 作为数据存储来保存我们的配置。</strong></p>
<p>让我们看一个使用 Apache Curator 获取和设置数据的示例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CuratorFramework</span> <span class="n">client</span> <span class="o">=</span> <span class="n">newClient</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">AsyncCuratorFramework</span> <span class="n">async</span> <span class="o">=</span> <span class="n">AsyncCuratorFramework</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">getKey</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">&#34;my_value&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">forPath</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span><span class="o">.</span><span class="na">setData</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">forPath</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">expected</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">AtomicBoolean</span> <span class="n">isEquals</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicBoolean</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">async</span><span class="o">.</span><span class="na">getData</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">forPath</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">thenAccept</span><span class="o">(</span><span class="n">data</span> <span class="o">-&gt;</span> <span class="n">isEquals</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">data</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">expected</span><span class="o">)));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">await</span><span class="o">().</span><span class="na">until</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">assertThat</span><span class="o">(</span><span class="n">isEquals</span><span class="o">.</span><span class="na">get</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">());</span>
</span></span></code></pre></div><p>在这个例子中，我们创建节点路径，在 Zookeeper 中设置数据，然后我们检查它的值是否相同来恢复它。<em>关键字</em>段可以是像*/config/dev/my_key*这样的节点路径。</p>
<h3 id="51-观察者"><strong>5.1 观察者</strong></h3>
<p>Zookeeper 中另一个有趣的特性是能够监视键或节点。<strong>它允许我们监听配置的变化并更新我们的应用程序，而无需重新部署</strong>.</p>
<p>让我们看看上面的例子在使用 watchers 时的样子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CuratorFramework</span> <span class="n">client</span> <span class="o">=</span> <span class="n">newClient</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">AsyncCuratorFramework</span> <span class="n">async</span> <span class="o">=</span> <span class="n">AsyncCuratorFramework</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">getKey</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">&#34;my_value&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">forPath</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">changes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">async</span><span class="o">.</span><span class="na">watched</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">getData</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">forPath</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">event</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">thenAccept</span><span class="o">(</span><span class="n">watchedEvent</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">changes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">getData</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">forPath</span><span class="o">(</span><span class="n">watchedEvent</span><span class="o">.</span><span class="na">getPath</span><span class="o">())));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// fail ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Set data value for our key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">async</span><span class="o">.</span><span class="na">setData</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">forPath</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">expected</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">await</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">until</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">assertThat</span><span class="o">(</span><span class="n">changes</span><span class="o">.</span><span class="na">size</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">1</span><span class="o">));</span>
</span></span></code></pre></div><p>我们配置观察者，设置数据，然后确认被观察事件被触发。我们可以一次观察一个节点或一组节点。</p>
<h2 id="6-强类型模型"><strong>6. 强类型模型</strong></h2>
<p>Zookeeper 主要处理字节数组，所以我们需要对我们的数据进行序列化和反序列化。这使我们能够灵活地处理任何可序列化的实例，但它可能难以维护。</p>
<p>为了在这里提供帮助，Curator 添加了<a href="https://curator.apache.org/curator-x-async/modeled.html" target="_blank" rel="noopener noreffer">类型化模型</a>的概念，它<strong>委托序列化/反序列化并允许我们直接使用我们的类型</strong>。让我们看看它是如何工作的。</p>
<p>首先，我们需要一个序列化器框架。Curator 建议使用 Jackson 实现，所以让我们将<a href="https://search.maven.org/classic/#search%7Cgav%7C1%7Cg%3A%22com.fasterxml.jackson.core%22%20AND%20a%3A%22jackson-databind%22" target="_blank" rel="noopener noreffer">Jackson 依赖</a>项添加到我们的<em>pom.xml</em>中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>2.13.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>现在，让我们尝试持久化我们的自定义类<em>HostConfig</em>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HostConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">hostname</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">port</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// getters and setters
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>我们需要提供从<em>HostConfig</em>类到路径的模型规范映射，并使用 Apache Curator 提供的建模框架包装器：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ModelSpec</span><span class="o">&lt;</span><span class="n">HostConfig</span><span class="o">&gt;</span> <span class="n">mySpec</span> <span class="o">=</span> <span class="n">ModelSpec</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">ZPath</span><span class="o">.</span><span class="na">parseWithIds</span><span class="o">(</span><span class="s">&#34;/config/dev&#34;</span><span class="o">),</span> 
</span></span><span class="line"><span class="cl">  <span class="n">JacksonModelSerializer</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">HostConfig</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">CuratorFramework</span> <span class="n">client</span> <span class="o">=</span> <span class="n">newClient</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">AsyncCuratorFramework</span> <span class="n">async</span> 
</span></span><span class="line"><span class="cl">  <span class="o">=</span> <span class="n">AsyncCuratorFramework</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ModeledFramework</span><span class="o">&lt;</span><span class="n">HostConfig</span><span class="o">&gt;</span> <span class="n">modeledClient</span> 
</span></span><span class="line"><span class="cl">  <span class="o">=</span> <span class="n">ModeledFramework</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="n">async</span><span class="o">,</span> <span class="n">mySpec</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">modeledClient</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">HostConfig</span><span class="o">(</span><span class="s">&#34;host-name&#34;</span><span class="o">,</span> <span class="n">8080</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">modeledClient</span><span class="o">.</span><span class="na">read</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">whenComplete</span><span class="o">((</span><span class="n">value</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">fail</span><span class="o">(</span><span class="s">&#34;Cannot read host config&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">     <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">assertThat</span><span class="o">(</span><span class="n">value</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">          <span class="n">assertThat</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">getHostname</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">&#34;host-name&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">assertThat</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">getPort</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">8080</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">     <span class="o">}</span>
</span></span><span class="line"><span class="cl">   <span class="o">});</span>
</span></span></code></pre></div><p>读取路径*/config/dev<em>时的</em>whenComplete()<em>方法将返回 Zookeeper 中的</em>HostConfig*实例。</p>
<h2 id="7-recipes"><strong>7. recipes</strong></h2>
<p>Zookeeper 提供<a href="https://zookeeper.apache.org/doc/current/recipes.html" target="_blank" rel="noopener noreffer">此指南</a>来实现<strong>高级解决方案或配方，例如领导者选举、分布式锁或共享计数器。</strong></p>
<p>Apache Curator 为大多数这些配方提供了一个实现。要查看完整列表，请访问<a href="https://curator.apache.org/curator-recipes/index.html" target="_blank" rel="noopener noreffer">文档</a>。</p>
<p>所有这些recipes都在一个单独的模块中可用：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.apache.curator<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>curator-recipes<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>4.0.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>让我们直接进入并通过一些简单的例子开始理解这些。</p>
<h3 id="71-领袖选举"><strong>7.1 领袖选举</strong></h3>
<p>在分布式环境中，我们可能需要一个主节点或领导节点来协调一项复杂的工作。</p>
<p>这是Curator<a href="https://curator.apache.org/curator-recipes/leader-election.html" target="_blank" rel="noopener noreffer">中领导人选举配方的用法：</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CuratorFramework</span> <span class="n">client</span> <span class="o">=</span> <span class="n">newClient</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">LeaderSelector</span> <span class="n">leaderSelector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LeaderSelector</span><span class="o">(</span><span class="n">client</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">  <span class="s">&#34;/mutex/select/leader/for/job/A&#34;</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="n">LeaderSelectorListener</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stateChanged</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">CuratorFramework</span> <span class="n">client</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">        <span class="n">ConnectionState</span> <span class="n">newState</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">takeLeadership</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">CuratorFramework</span> <span class="n">client</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// join the members group
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">leaderSelector</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// wait until the job A is done among all members
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">leaderSelector</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span></code></pre></div><p>当我们启动领导者选择器时，我们的节点会加入路径*/mutex/select/leader/for/job/A<em>中的成员组。一旦我们的节点成为领导者，将调用</em>takeLeadership*方法，我们作为领导者可以恢复工作。</p>
<h3 id="72-共享锁"><strong>7.2. 共享锁</strong></h3>
<p><a href="https://curator.apache.org/curator-recipes/shared-lock.html" target="_blank" rel="noopener noreffer">共享锁配方</a>是关于拥有一个完全分布式的锁：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CuratorFramework</span> <span class="n">client</span> <span class="o">=</span> <span class="n">newClient</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">InterProcessSemaphoreMutex</span> <span class="n">sharedLock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InterProcessSemaphoreMutex</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">client</span><span class="o">,</span> <span class="s">&#34;/mutex/process/A&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sharedLock</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// do process A
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">sharedLock</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</span></span></code></pre></div><p>当我们获取锁时，Zookeeper 确保没有其他应用程序同时获取相同的锁。</p>
<h3 id="73-计数器"><strong>7.3. 计数器</strong></h3>
<p><a href="https://curator.apache.org/curator-recipes/shared-counter.html" target="_blank" rel="noopener noreffer">Counters 配方</a>在所有客户端之间协调一个共享的<em>Integer ：</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CuratorFramework</span> <span class="n">client</span> <span class="o">=</span> <span class="n">newClient</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">SharedCount</span> <span class="n">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SharedCount</span><span class="o">(</span><span class="n">client</span><span class="o">,</span> <span class="s">&#34;/counters/A&#34;</span><span class="o">,</span> <span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">counter</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">counter</span><span class="o">.</span><span class="na">setCount</span><span class="o">(</span><span class="n">counter</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">+</span> <span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">assertThat</span><span class="o">(</span><span class="n">counter</span><span class="o">.</span><span class="na">getCount</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
</span></span></code></pre></div><p>在此示例中，Zookeeper 将<em>Integer</em>值存储在路径*/counters/A<em>中，如果尚未创建路径，则将该值初始化为</em>0* 。
&quot;</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-07-25</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://itcodingman.github.io/apache_curator/" data-title="Apache Curator 简介"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://itcodingman.github.io/apache_curator/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://itcodingman.github.io/apache_curator/" data-title="Apache Curator 简介"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://itcodingman.github.io/apache_curator/" data-title="Apache Curator 简介"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://itcodingman.github.io/apache_curator/" data-title="Apache Curator 简介"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/apache_crunch/" class="prev" rel="prev" title="Apache Crunch 指南"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Apache Crunch 指南</a>
            <a href="/apache_cxf_rest_api/" class="next" rel="next" title="Apache CXF 对 RESTful Web 服务的支持">Apache CXF 对 RESTful Web 服务的支持<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">codingman</a></span></div>
        </div>
    </footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-XH3B2JPQ1K', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-XH3B2JPQ1K" async></script></body>
</html>
