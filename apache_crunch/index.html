<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Apache Crunch 指南 - Coding Man</title><meta name="Description" content="This is my cool site"><meta property="og:title" content="Apache Crunch 指南" />
<meta property="og:description" content="简介 在本教程中，我们将 使用示例数据处理应用程序演示Apache Crunch 。我们将使用MapReduce框架运行这个应用程序。 我们将首先简要介绍一些 Apache" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://itcodingman.github.io/apache_crunch/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-05-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-07-23T00:00:00+00:00" /><meta property="og:site_name" content="My cool site" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Apache Crunch 指南"/>
<meta name="twitter:description" content="简介 在本教程中，我们将 使用示例数据处理应用程序演示Apache Crunch 。我们将使用MapReduce框架运行这个应用程序。 我们将首先简要介绍一些 Apache"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2168947316195146"
     crossorigin="anonymous"></script><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://itcodingman.github.io/apache_crunch/" /><link rel="prev" href="http://itcodingman.github.io/apache_commons_setutils/" /><link rel="next" href="http://itcodingman.github.io/apache_curator/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Apache Crunch 指南",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/itcodingman.github.io\/apache_crunch\/"
        },"genre": "posts","wordcount":  3522 ,
        "url": "http:\/\/itcodingman.github.io\/apache_crunch\/","datePublished": "2018-05-06T00:00:00+00:00","dateModified": "2022-07-23T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "codingman"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Coding Man"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/logo.jpg"
        data-srcset="/logo.jpg, /logo.jpg 1.5x, /logo.jpg 2x"
        data-sizes="auto"
        alt="/logo.jpg"
        title="/logo.jpg" />Coding Man</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 
										</a><a class="menu-item" href="/tags/"> 标签 
										</a><a class="menu-item" href="/categories/"> 分类 
										</a><a class="menu-item" href="/search/"><i class='fas fa-fw fa-search'></i> 搜索 
										</a>
										<div class="dropdown">
											<a href="javascript:void(0);" class="menu-item menu-more dropbtn" title="" > 链接 
											</a>
											<div class="menu-more-content dropdown-content"><a href="https://space.bilibili.com/499533333" title="" target="_blank" rel="noopener"> BiliBili </a><a href="https://www.youtube.com/c/itcodingman" title="" target="_blank" rel="noopener"> YouTube </a></div>
										</div>
									<span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Coding Man"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/logo.jpg"
        data-srcset="/logo.jpg, /logo.jpg 1.5x, /logo.jpg 2x"
        data-sizes="auto"
        alt="/logo.jpg"
        title="/logo.jpg" />Coding Man</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/"> 文章 
								</a><a class="menu-item" href="/tags/"> 标签 
								</a><a class="menu-item" href="/categories/"> 分类 
								</a><a class="menu-item" href="/search/"><i class='fas fa-fw fa-search'></i> 搜索 
								</a>
								<div class="dropdown">
									<a href="javascript:void(0);" class="menu-item menu-more dropbtn" title="" > 链接 
									</a>
									<div class="menu-more-content dropdown-content"><a href="https://space.bilibili.com/499533333" title="" target="_blank" rel="noopener"> BiliBili </a><a href="https://www.youtube.com/c/itcodingman" title="" target="_blank" rel="noopener"> YouTube </a></div>
								</div>
							<a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container">
                    <div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Apache Crunch 指南</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>codingman</a></span>&nbsp;<span class="post-category">included in <a href="/categories/data/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Data</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2018-05-06">2018-05-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;3522 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;8 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#31maven-依赖项">3.1。Maven 依赖项</a></li>
        <li><a href="#32-maven-原型">3.2. Maven 原型</a></li>
        <li><a href="#61将一行文本拆分为单词">6.1。将一行文本拆分为单词</a></li>
        <li><a href="#62-删除停用词">6.2. 删除停用词</a></li>
        <li><a href="#63-计算唯一单词">6.3. 计算唯一单词</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><ol>
<li>简介</li>
</ol>
<hr>
<p>在本教程中，我们将  使用示例数据处理应用程序演示<a href="https://crunch.apache.org/" target="_blank" rel="noopener noreffer">Apache Crunch 。</a>我们将使用<a href="https://en.wikipedia.org/wiki/MapReduce" target="_blank" rel="noopener noreffer">MapReduce</a>框架运行这个应用程序。</p>
<p>我们将首先简要介绍一些 Apache Crunch 概念。然后我们将进入一个示例应用程序。在这个应用程序中，我们将进行文本处理：</p>
<ul>
<li>首先，我们将从文本文件中读取行</li>
<li>稍后，我们将它们拆分为单词并删除一些常用单词</li>
<li>然后，我们将剩余的单词分组以获得唯一单词列表及其计数</li>
<li>最后，我们将此列表写入文本文件</li>
</ul>
<ol start="2">
<li>什么是紧缩？</li>
</ol>
<hr>
<p>MapReduce 是一种分布式并行编程框架，用于在服务器集群上处理大量数据。Hadoop 和 Spark 等软件框架实现了 MapReduce。</p>
<p>**Crunch 提供了一个框架，用于在 Java 中编写、测试和运行 MapReduce 管道。**在这里，我们不直接编写 MapReduce 作业。相反，我们使用 Crunch API 定义数据管道（即执行输入、处理和输出步骤的操作）。Crunch Planner 将它们映射到 MapReduce 作业并在需要时执行它们。</p>
<p>**<em>因此，每个 Crunch 数据管道都由Pipeline</em>接口的一个实例进行协调。<em><em><em>该接口还定义了通过Source</em>实例将数据读入管道以及将数据从管道写入</em>Target</em>实例的方法。</p>
<p>我们有 3 个接口来表示数据：</p>
<ol>
<li><em>PCollection</em>  – 不可变的分布式元素集合</li>
<li><em>PTable&lt;K</em> , V <em>&gt;</em>  – 一个不可变的、分布式的、无序的键和值的多映射</li>
<li><em>PGroupedTable&lt;K</em> , V <em>&gt;</em> – K 类型键到可迭代 V<em>的</em>分布式排序映射，可仅迭代一次</li>
</ol>
<p><em><strong>DoFn</strong></em><strong>是所有数据处理函数的基类</strong>。它对应  于 MapReduce<em>中的Mapper</em>、  <em>Reducer</em> 和 <em>Combiner类。<em>我们将大部分开发时间用于编写和测试使用它的逻辑计算</em>。</em></p>
<p>现在我们对 Crunch 更加熟悉了，让我们使用它来构建示例应用程序。</p>
<ol start="3">
<li>建立一个 Crunch 项目</li>
</ol>
<hr>
<p>首先，让我们用 Maven 建立一个 Crunch 项目。我们可以通过两种方式做到这一点：</p>
<ol>
<li>在现有项目的<em>pom.xml</em>文件中添加所需的依赖项</li>
<li>使用原型生成启动项目</li>
</ol>
<p>让我们快速浏览一下这两种方法。</p>
<h3 id="31maven-依赖项">3.1。Maven 依赖项</h3>
<p>为了将 Crunch 添加到现有项目，让我们在 <em>pom.xml</em>文件中添加所需的依赖项。</p>
<p>首先，让我们添加<em>crunch-core</em>库：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.apache.crunch<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>crunch-core<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>0.15.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>接下来，让我们添加<em>hadoop-client</em>库来与 Hadoop 通信。我们使用匹配Hadoop安装的版本：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.apache.hadoop<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>hadoop-client<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>2.2.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>我们可以查看 Maven Central 以获取最新版本的<a href="https://search.maven.org/search?q=g:org.apache.crunch%20AND%20a:crunch-core&amp;core=gav" target="_blank" rel="noopener noreffer">crunch-core</a>和<a href="https://search.maven.org/search?q=g:org.apache.hadoop%20AND%20a:hadoop-client&amp;core=gav" target="_blank" rel="noopener noreffer">hadoop-client</a>库。</p>
<h3 id="32-maven-原型">3.2. Maven 原型</h3>
<p><strong>另一种方法是使用 Crunch 提供的 Maven 原型快速生成一个入门项目</strong>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">mvn archetype:generate -Dfilter=org.apache.crunch:crunch-archetype
</span></span></code></pre></div><p>当上述命令提示时，我们提供 Crunch 版本和项目工件详细信息。</p>
<ol start="4">
<li>紧缩管道设置</li>
</ol>
<hr>
<p>设置好项目后，我们需要创建一个<em>Pipeline</em>对象。 <strong>Crunch 有 3 个<em>Pipeline</em>实现</strong>：</p>
<ul>
<li><em>MRPipeline</em> – 在 Hadoop MapReduce 中执行</li>
<li><em>SparkPipeline</em> – 作为一系列 Spark 管道执行</li>
<li><em>MemPipeline</em> – 在客户端内存中执行，对单元测试很有用</li>
</ul>
<p>通常，我们使用<em>MemPipeline</em>的实例进行开发和测试。稍后我们使用<em>MRPipeline</em>或<em>SparkPipeline</em>的实例进行实际执行。</p>
<p>如果我们需要一个内存管道，我们可以使用静态方法<em>getInstance</em>来获取<em>MemPipeline</em>实例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">MemPipeline</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
</span></span></code></pre></div><p>但是现在，让我们创建一个<em>MRPipeline</em>实例 来使用 Hadoop 执行应用程序*：*</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MRPipeline</span><span class="o">(</span><span class="n">WordCount</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">getConf</span><span class="o">());</span>
</span></span></code></pre></div><ol start="5">
<li>读取输入数据</li>
</ol>
<hr>
<p>创建管道对象后，我们要读取输入数据。 <em><strong>Pipeline</strong></em><strong>接口提供了一种从文本文件读取输入的便捷方法</strong>， <em>即 readTextFile(pathName)。</em></p>
<p>让我们调用这个方法来读取输入文本文件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">readTextFile</span><span class="o">(</span><span class="n">inputPath</span><span class="o">);</span>
</span></span></code></pre></div><p>上面的代码将文本文件读取为<em>String</em>的集合。</p>
<p>下一步，让我们编写一个读取输入的测试用例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">givenPipeLine_whenTextFileRead_thenExpectedNumberOfRecordsRead</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">MemPipeline</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">readTextFile</span><span class="o">(</span><span class="n">INPUT_FILE_PATH</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">assertEquals</span><span class="o">(</span><span class="n">21</span><span class="o">,</span> <span class="n">lines</span><span class="o">.</span><span class="na">asCollection</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">getValue</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">size</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>在这个测试中，我们验证我们在读取文本文件时获得了预期的行数。</p>
<ol start="6">
<li>数据处理步骤</li>
</ol>
<hr>
<p>读取输入数据后，我们需要对其进行处理。 <strong>Crunch API 包含许多 <em>DoFn</em>的子类来处理常见的数据处理场景</strong>：</p>
<ul>
<li><em>FilterFn</em> – 根据布尔条件过滤集合成员</li>
<li><em>MapFn</em> – 将每个输入记录映射到一个输出记录</li>
<li><em>CombineFn</em> – 将多个值组合成一个值</li>
<li><em>JoinFn</em>  – 执行连接，例如内连接、左外连接、右外连接和完全外连接</li>
</ul>
<p>让我们通过使用这些类来实现以下数据处理逻辑：</p>
<ol>
<li>将输入文件中的每一行拆分为单词</li>
<li>删除停用词</li>
<li>计算唯一的单词</li>
</ol>
<h3 id="61将一行文本拆分为单词">6.1。将一行文本拆分为单词</h3>
<p>首先，让我们创建<em>Tokenizer</em>类来将一行拆分为单词。</p>
<p>我们将扩展 <em>DoFn</em> 类。这个类有一个叫做<em>process</em>的抽象方法。此方法处理来自<em>PCollection</em>的输入记录并将输出发送到<em>Emitter。</em></p>
<p>我们需要在这个方法中实现拆分逻辑：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tokenizer</span> <span class="kd">extends</span> <span class="n">DoFn</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Splitter</span> <span class="n">SPLITTER</span> <span class="o">=</span> <span class="n">Splitter</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">onPattern</span><span class="o">(</span><span class="s">&#34;\\s+&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">omitEmptyStrings</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">line</span><span class="o">,</span> <span class="n">Emitter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">emitter</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">word</span> <span class="o">:</span> <span class="n">SPLITTER</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="n">line</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">emitter</span><span class="o">.</span><span class="na">emit</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>在上面的实现中，我们使用了<a href="https://github.com/google/guava/wiki/StringsExplained#splitter" target="_blank" rel="noopener noreffer">Guava库中的</a><em>Splitter</em>类从一行中提取单词。</p>
<p><em>接下来，让我们为Tokenizer</em>类编写一个单元测试 ：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RunWith</span><span class="o">(</span><span class="n">MockitoJUnitRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TokenizerUnitTest</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Mock</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Emitter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">emitter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">givenTokenizer_whenLineProcessed_thenOnlyExpectedWordsEmitted</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Tokenizer</span> <span class="n">splitter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tokenizer</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">splitter</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="s">&#34;  hello  world &#34;</span><span class="o">,</span> <span class="n">emitter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">verify</span><span class="o">(</span><span class="n">emitter</span><span class="o">).</span><span class="na">emit</span><span class="o">(</span><span class="s">&#34;hello&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">verify</span><span class="o">(</span><span class="n">emitter</span><span class="o">).</span><span class="na">emit</span><span class="o">(</span><span class="s">&#34;world&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">verifyNoMoreInteractions</span><span class="o">(</span><span class="n">emitter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>上面的测试验证是否返回了正确的单词。</p>
<p>最后，让我们使用这个类分割从输入文本文件中读取的行。</p>
<p><em><em><em>PCollection</em>接口的</em>parallelDo</em>方法将给定的<em>DoFn</em>应用于所有元素并返回一个新的<em>PCollection</em>。**</p>
<p>让我们在 lines 集合上调用这个方法并传递一个<em>Tokenizer</em>的实例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">words</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="na">parallelDo</span><span class="o">(</span><span class="k">new</span> <span class="n">Tokenizer</span><span class="o">(),</span> <span class="n">Writables</span><span class="o">.</span><span class="na">strings</span><span class="o">());</span>
</span></span></code></pre></div><p>结果，我们得到了输入文本文件中的单词列表。我们将在下一步中删除停用词。</p>
<h3 id="62-删除停用词">6.2. 删除停用词</h3>
<p>与上一步类似，让我们创建一个<em>StopWordFilter</em>类来过滤掉停用词。</p>
<p>但是，我们将扩展 <em>FilterFn</em>而不是<em>DoFn</em>。<em>FilterFn有一个名为**accept</em>的抽象方法。我们需要在这个方法中实现过滤逻辑：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StopWordFilter</span> <span class="kd">extends</span> <span class="n">FilterFn</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// English stop words, borrowed from Lucene.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">STOP_WORDS</span> <span class="o">=</span> <span class="n">ImmutableSet</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span> <span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;and&#34;</span><span class="o">,</span> <span class="s">&#34;are&#34;</span><span class="o">,</span> <span class="s">&#34;as&#34;</span><span class="o">,</span> <span class="s">&#34;at&#34;</span><span class="o">,</span> <span class="s">&#34;be&#34;</span><span class="o">,</span> <span class="s">&#34;but&#34;</span><span class="o">,</span> <span class="s">&#34;by&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;for&#34;</span><span class="o">,</span> <span class="s">&#34;if&#34;</span><span class="o">,</span> <span class="s">&#34;in&#34;</span><span class="o">,</span> <span class="s">&#34;into&#34;</span><span class="o">,</span> <span class="s">&#34;is&#34;</span><span class="o">,</span> <span class="s">&#34;it&#34;</span><span class="o">,</span> <span class="s">&#34;no&#34;</span><span class="o">,</span> <span class="s">&#34;not&#34;</span><span class="o">,</span> <span class="s">&#34;of&#34;</span><span class="o">,</span> <span class="s">&#34;on&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;or&#34;</span><span class="o">,</span> <span class="s">&#34;s&#34;</span><span class="o">,</span> <span class="s">&#34;such&#34;</span><span class="o">,</span> <span class="s">&#34;t&#34;</span><span class="o">,</span> <span class="s">&#34;that&#34;</span><span class="o">,</span> <span class="s">&#34;the&#34;</span><span class="o">,</span> <span class="s">&#34;their&#34;</span><span class="o">,</span> <span class="s">&#34;then&#34;</span><span class="o">,</span> <span class="s">&#34;there&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;these&#34;</span><span class="o">,</span> <span class="s">&#34;they&#34;</span><span class="o">,</span> <span class="s">&#34;this&#34;</span><span class="o">,</span> <span class="s">&#34;to&#34;</span><span class="o">,</span> <span class="s">&#34;was&#34;</span><span class="o">,</span> <span class="s">&#34;will&#34;</span><span class="o">,</span> <span class="s">&#34;with&#34;</span> <span class="o">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">accept</span><span class="o">(</span><span class="n">String</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">!</span><span class="n">STOP_WORDS</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>接下来，让我们编写<em>StopWordFilter</em>类的单元测试：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StopWordFilterUnitTest</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">givenFilter_whenStopWordPassed_thenFalseReturned</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">FilterFn</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StopWordFilter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">assertFalse</span><span class="o">(</span><span class="n">filter</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">&#34;the&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">assertFalse</span><span class="o">(</span><span class="n">filter</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">givenFilter_whenNonStopWordPassed_thenTrueReturned</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">FilterFn</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StopWordFilter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">assertTrue</span><span class="o">(</span><span class="n">filter</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">&#34;Hello&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">assertTrue</span><span class="o">(</span><span class="n">filter</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">&#34;World&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">givenWordCollection_whenFiltered_thenStopWordsRemoved</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">words</span> <span class="o">=</span> <span class="n">MemPipeline</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">collectionOf</span><span class="o">(</span><span class="s">&#34;This&#34;</span><span class="o">,</span> <span class="s">&#34;is&#34;</span><span class="o">,</span> <span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;test&#34;</span><span class="o">,</span> <span class="s">&#34;sentence&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">noStopWords</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="k">new</span> <span class="n">StopWordFilter</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">assertEquals</span><span class="o">(</span><span class="n">ImmutableList</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;This&#34;</span><span class="o">,</span> <span class="s">&#34;test&#34;</span><span class="o">,</span> <span class="s">&#34;sentence&#34;</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">         <span class="n">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">(</span><span class="n">noStopWords</span><span class="o">.</span><span class="na">materialize</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>此测试验证过滤逻辑是否正确执行。</p>
<p>最后，让我们使用<em>StopWordFilter</em>来过滤上一步生成的单词列表。 <em><strong>PCollection</strong></em><strong>接口的<em>filter</em>方法将给定的<em>FilterFn</em>应用于所有元素并返回一个新的<em>PCollection</em>。</strong></p>
<p>让我们在 words 集合上调用这个方法并传递一个<em>StopWordFilter</em>的实例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">noStopWords</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="k">new</span> <span class="n">StopWordFilter</span><span class="o">());</span>
</span></span></code></pre></div><p>结果，我们得到了过滤后的单词集合。</p>
<h3 id="63-计算唯一单词">6.3. 计算唯一单词</h3>
<p>在获得过滤后的单词集合后，我们要计算每个单词出现的频率。 <strong><em>PCollection</em>接口有许多方法来执行常见的聚合：</strong></p>
<ul>
<li><em>min</em> – 返回集合的最小元素</li>
<li><em>max</em> – 返回集合的最大元素</li>
<li><em>length</em> – 返回集合中元素的数量</li>
<li><em>count</em> – 返回一个<em>PTable</em>，其中包含集合中每个唯一元素的计数</li>
</ul>
<p>让我们使用<em>count</em>方法来获取唯一单词及其计数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// The count method applies a series of Crunch primitives and returns
</span></span></span><span class="line"><span class="cl"><span class="c1">// a map of the unique words in the input PCollection to their counts.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">PTable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">noStopWords</span><span class="o">.</span><span class="na">count</span><span class="o">();</span>
</span></span></code></pre></div><ol start="7">
<li>指定输出</li>
</ol>
<hr>
<p>作为前面步骤的结果，我们有一个单词表和它们的计数。我们想将此结果写入文本文件。 <em><strong>Pipeline</strong></em><strong>接口提供了方便****的 方法来编写输出：</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="n">PCollection</span><span class="o">&lt;?&gt;</span> <span class="n">collection</span><span class="o">,</span> <span class="n">Target</span> <span class="n">target</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="n">PCollection</span><span class="o">&lt;?&gt;</span> <span class="n">collection</span><span class="o">,</span> <span class="n">Target</span> <span class="n">target</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">Target</span><span class="o">.</span><span class="na">WriteMode</span> <span class="n">writeMode</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">writeTextFile</span><span class="o">(</span><span class="n">PCollection</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">pathName</span><span class="o">);</span>
</span></span></code></pre></div><p>因此，让我们调用 <em>writeTextFile</em>方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">pipeline</span><span class="o">.</span><span class="na">writeTextFile</span><span class="o">(</span><span class="n">counts</span><span class="o">,</span> <span class="n">outputPath</span><span class="o">);</span>
</span></span></code></pre></div><ol start="8">
<li>管理管道执行</li>
</ol>
<hr>
<p>到目前为止，所有步骤都刚刚定义了数据管道。未读取或处理任何输入。这是因为 <strong>Crunch 使用了惰性执行模型。</strong></p>
<p>在 Pipeline 接口上调用控制作业计划和执行的方法之前，它不会运行 MapReduce 作业：</p>
<ul>
<li><em>run</em>  - 准备一个执行计划来创建所需的输出，然后同步执行它</li>
<li><em>完成</em>- 运行生成输出所需的任何剩余作业，然后清理创建的任何中间数据文件</li>
<li><em>runAsync</em> - 类似于 run 方法，但以非阻塞方式执行</li>
</ul>
<p>因此，让我们调用<em>done</em>方法将管道作为 MapReduce 作业执行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">PipelineResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">done</span><span class="o">();</span>
</span></span></code></pre></div><p>上面的语句运行 MapReduce 作业以读取输入、处理它们并将结果写入输出目录。</p>
<ol start="9">
<li>整合管道</li>
</ol>
<hr>
<p>到目前为止，我们已经开发并单元测试了读取输入数据、处理它并写入输出文件的逻辑。</p>
<p>接下来，让我们将它们放在一起构建整个数据管道：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">run</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">inputPath</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="n">0</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">outputPath</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="n">1</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Create an object to coordinate pipeline creation and execution.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MRPipeline</span><span class="o">(</span><span class="n">WordCount</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">getConf</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Reference a given text file as a collection of Strings.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">readTextFile</span><span class="o">(</span><span class="n">inputPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Define a function that splits each line in a PCollection of Strings into
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// a PCollection made up of the individual words in the file.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// The second argument sets the serialization format.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">words</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="na">parallelDo</span><span class="o">(</span><span class="k">new</span> <span class="n">Tokenizer</span><span class="o">(),</span> <span class="n">Writables</span><span class="o">.</span><span class="na">strings</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Take the collection of words and remove known stop words.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">noStopWords</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="k">new</span> <span class="n">StopWordFilter</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The count method applies a series of Crunch primitives and returns
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// a map of the unique words in the input PCollection to their counts.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">PTable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">noStopWords</span><span class="o">.</span><span class="na">count</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Instruct the pipeline to write the resulting counts to a text file.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">pipeline</span><span class="o">.</span><span class="na">writeTextFile</span><span class="o">(</span><span class="n">counts</span><span class="o">,</span> <span class="n">outputPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Execute the pipeline as a MapReduce.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">PipelineResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">done</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">succeeded</span><span class="o">()</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ol start="10">
<li>Hadoop 启动配置</li>
</ol>
<hr>
<p>数据管道因此准备就绪。</p>
<p>但是，我们需要代码来启动它。因此，让我们编写启动应用程序的<em>main</em>方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WordCount</span> <span class="kd">extends</span> <span class="n">Configured</span> <span class="kd">implements</span> <span class="n">Tool</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ToolRunner</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">Configuration</span><span class="o">(),</span> <span class="k">new</span> <span class="n">WordCount</span><span class="o">(),</span> <span class="n">args</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p><strong><em>ToolRunner.run 从命令行</em> 解析 Hadoop 配置并执行 MapReduce 作业。</strong></p>
<ol start="11">
<li>运行应用程序</li>
</ol>
<hr>
<p>完整的应用程序现已准备就绪。让我们运行以下命令来构建它：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">mvn package
</span></span></code></pre></div><p>作为上述命令的结果，我们在目标目录中获得了打包的应用程序和一个特殊的作业 jar。</p>
<p>让我们使用这个作业 jar 在 Hadoop 上执行应用程序：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">hadoop jar target/crunch-1.0-SNAPSHOT-job.jar &lt;input file path&gt; &lt;output directory&gt;
</span></span></code></pre></div><p>应用程序读取输入文件并将结果写入输出文件。输出文件包含唯一单词及其计数，类似于以下内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">[Add,1]
</span></span><span class="line"><span class="cl">[Added,1]
</span></span><span class="line"><span class="cl">[Admiration,1]
</span></span><span class="line"><span class="cl">[Admitting,1]
</span></span><span class="line"><span class="cl">[Allowance,1]
</span></span></code></pre></div><p>除了 Hadoop，我们还可以在 IDE 中运行应用程序，作为独立应用程序或单元测试。</p>
<ol start="12">
<li>结论</li>
</ol>
<hr>
<p>在本教程中，我们创建了一个在 MapReduce 上运行的数据处理应用程序。Apache Crunch 使使用 Java 编写、测试和执行 MapReduce 管道变得容易。</p>
<p>通用底部</p>
<p>通用页脚横幅</p>
<p>&quot;</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-07-23</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://itcodingman.github.io/apache_crunch/" data-title="Apache Crunch 指南"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://itcodingman.github.io/apache_crunch/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://itcodingman.github.io/apache_crunch/" data-title="Apache Crunch 指南"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://itcodingman.github.io/apache_crunch/" data-title="Apache Crunch 指南"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://itcodingman.github.io/apache_crunch/" data-title="Apache Crunch 指南"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/apache_commons_setutils/" class="prev" rel="prev" title="Apache Commons 集合 SetUtils"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Apache Commons 集合 SetUtils</a>
            <a href="/apache_curator/" class="next" rel="next" title="Apache Curator 简介">Apache Curator 简介<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">codingman</a></span></div>
        </div>
    </footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-XH3B2JPQ1K', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-XH3B2JPQ1K" async></script></body>
</html>
